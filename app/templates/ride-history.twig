{% extends "layout.twig" %}

{% block title %}My Ride History | EcoRide{% endblock %}

{% block content %}
<div class="max-w-2xl mx-auto mt-8 bg-white p-6 rounded-lg shadow-md">
    <h2 class="text-2xl font-semibold text-center mb-6 text-green-700">My Ride History</h2>

    {% set labels = {
        'upcoming': 'üü¢ Upcoming',
        'in progress': 'üü° In Progress',
        'completed': '‚úÖ Completed',
        'canceled': '‚ùå Canceled'
    } %}

    {% for group, rides in grouped_rides %}
        {% if rides is not empty %}
            <h3 class="text-xl font-bold mt-6 mb-2 text-gray-800">{{ labels[group] }}</h3>
            <ul class="space-y-4 mb-4">
                {% for ride in rides %}
                    <li class="border-b pb-2">
                        <p><strong>Pickup:</strong> {{ ride.pickup_location }}</p>
                        <p><strong>Dropoff:</strong> {{ ride.dropoff_location }}</p>
                        <p><strong>Seats:</strong> {{ ride.passenger_count }}</p>
                        <p><strong>Departure:</strong> {{ ride.departure_time|date("d M Y ‚Äì H:i") }}</p>

                        <p><strong>Status:</strong> {{ ride.carpool_status|capitalize }}</p>

                        {% if ride.carpool_status == 'upcoming' %}
                            <form method="POST" action="/cancel-ride/{{ ride.id }}">
                                <button type="submit"
                                        class="mt-2 bg-red-600 hover:bg-red-700 text-white text-sm px-4 py-1 rounded">
                                    Cancel Ride
                                </button>
                            </form>
                        {% endif %}
                        {% if group == 'completed' and not ride.review_exists %}
                            <form method="GET" action="/review/{{ ride.id }}">
                                <button class="mt-2 bg-blue-600 hover:bg-blue-700 text-white text-sm px-4 py-1 rounded">
                                    Leave a Review
                                </button>
                            </form>
                        {% endif %}
                    </li>
                {% endfor %}
            </ul>
        {% endif %}
    {% endfor %}
</div>
{% endblock %}
